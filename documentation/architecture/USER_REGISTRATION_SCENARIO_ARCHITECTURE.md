# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

## –û–±–∑–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —è–≤–ª—è–µ—Ç—Å—è —Ç–æ—á–∫–æ–π –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É –≤–æ–ª–µ–π–±–æ–ª—å–Ω—ã—Ö –∏–≥—Ä, –≥–¥–µ –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –ø–µ—Ä–≤–∏—á–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø—Ä–æ—Ñ–∏–ª—è –∏ –≤—ã–±–∏—Ä–∞—é—Ç —Ä–æ–ª—å –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ. –°—Ü–µ–Ω–∞—Ä–∏–π –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —à–∞–≥–æ–≤, –ø–æ–∑–≤–æ–ª—è—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (Telegram)
        ‚îÇ
        ‚ñº
    /start command
        ‚îÇ
        ‚ñº
RegistrationHandler.handleStart()
        ‚îÇ
        ‚ñº
    –í—ã–±–æ—Ä —Ä–æ–ª–∏ (inline keyboard)
        ‚îÇ
        ‚îú‚îÄ‚ñ∫ role_player ‚îÄ‚îÄ‚ñ∫ LevelSelectionHandler.handleRolePlayer()
        ‚îÇ                     ‚îÇ
        ‚îÇ                     ‚ñº
        ‚îÇ                 –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è (level_novice, level_amateur, etc.)
        ‚îÇ                     ‚îÇ
        ‚îÇ                     ‚ñº
        ‚îÇ                 updateUserLevel() use-case
        ‚îÇ                     ‚îÇ
        ‚îÇ                     ‚ñº
        ‚îÇ                 –í—ã–±–æ—Ä –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        ‚îÇ                     ‚îÇ
        ‚îÇ                     ‚ñº
        ‚îÇ                 finish_registration
        ‚îÇ
        ‚îî‚îÄ‚ñ∫ role_organizer ‚îÄ‚îÄ‚ñ∫ RegistrationHandler.handleRoleOrganizer()
                              ‚îÇ
                              ‚ñº
                          registerOrganizer() use-case
```

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π (User Journey)

### –®–∞–≥ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (/start)
**–¢—Ä–∏–≥–≥–µ—Ä:** –ö–æ–º–∞–Ω–¥–∞ `/start` –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ë–æ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤—ã–±—Ä–∞—Ç—å —Ä–æ–ª—å (–ò–≥—Ä–æ–∫/–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä)
- –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ

**–°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**
```
–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤–æ–ª–µ–π–±–æ–ª—å–Ω—ã—Ö –∏–≥—Ä. –í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Ä–æ–ª—å:
[–ò–≥—Ä–æ–∫] [–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä]
```

### –®–∞–≥ 2A: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–≥—Ä–æ–∫–∞ (role_player)
**–¢—Ä–∏–≥–≥–µ—Ä:** –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–ò–≥—Ä–æ–∫"  
**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ë–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤—ã–±—Ä–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —É—Ä–æ–≤–Ω–µ–π

**–°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**
```
–¢—ã –≤—ã–±—Ä–∞–ª —Ä–æ–ª—å –∏–≥—Ä–æ–∫–∞. –¢–µ–ø–µ—Ä—å –æ—Ü–µ–Ω–∏ —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å:
[–ù–æ–≤–∏—á–æ–∫] [–õ—é–±–∏—Ç–µ–ª—å] [–û–ø—ã—Ç–Ω—ã–π] [–ü—Ä–æ—Ñ–∏]
```

### –®–∞–≥ 2B: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞ (role_organizer)
**–¢—Ä–∏–≥–≥–µ—Ä:** –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä"  
**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞ –≤ —Å–∏—Å—Ç–µ–º–µ
- –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –∏–≥—Ä

**–°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**
```
–¢—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä! –°–æ–∑–¥–∞–π –∏–≥—Ä—É –∫–æ–º–∞–Ω–¥–æ–π /newgame
```

### –®–∞–≥ 3: –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞ (level_*)
**–¢—Ä–∏–≥–≥–µ—Ä:** –í—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è (level_novice, level_amateur, level_experienced, level_pro)  
**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞ –≤ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤—ã–±–æ—Ä –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤)
- –ó–∞–≤–µ—Ä—à–∞–µ—Ç –±–∞–∑–æ–≤—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

**–°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**
```
–û—Ç–ª–∏—á–Ω–æ! –•–æ—á–µ—à—å –≤—ã–±—Ä–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π –Ω–∞ –∏–≥—Ä—ã?
[–í—ã–±—Ä–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤] [–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å]
```

### –®–∞–≥ 4: –í—ã–±–æ—Ä –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤ (select_organizers_registration)
**–¢—Ä–∏–≥–≥–µ—Ä:** –ù–∞–∂–∞—Ç–∏–µ "–í—ã–±—Ä–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤"  
**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–±—Ä–∞—Ç—å –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö
- –°–æ–∑–¥–∞–µ—Ç —Å–≤—è–∑–∏ –∏–≥—Ä–æ–∫-–æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º pending

### –®–∞–≥ 5: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (finish_registration)
**–¢—Ä–∏–≥–≥–µ—Ä:** –ù–∞–∂–∞—Ç–∏–µ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å" –∏–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤  
**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —É—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**
```
–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å –∏—Å–∫–∞—Ç—å –∏–≥—Ä—ã –∫–æ–º–∞–Ω–¥–æ–π /games
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

#### 1. Bot Layer (src/bot/)
**–§–∞–π–ª—ã:** `src/bot/bot.ts`, `src/bot/registration/`

**–ö–ª—é—á–µ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:**
- [`registration-handler.ts`](src/bot/registration/registration-handler.ts:18) - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã start –∏ —Ä–æ–ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞
- [`level-selection-handler.ts`](src/bot/registration/level-selection-handler.ts:18) - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–æ–ª–∏ –∏–≥—Ä–æ–∫–∞ –∏ –≤—ã–±–æ—Ä–∞ —É—Ä–æ–≤–Ω—è
- [`bot.ts`](src/bot/bot.ts:21) - –ì–ª–∞–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:**
```typescript
// src/bot/bot.ts:21-91
bot.start(RegistrationHandler.handleStart);
bot.action('role_player', LevelSelectionHandler.handleRolePlayer);
bot.action('role_organizer', RegistrationHandler.handleRoleOrganizer);
bot.action(/^level_(.+)$/, async (ctx) => {
  const level = CallbackDataParser.parseLevel(ctx.match[0]!);
  if (level) {
    await LevelSelectionHandler.handleLevelSelection(ctx, level);
  }
});
bot.action('select_organizers_registration', OrganizerSelectionHandler.handleSelectOrganizersRegistration);
bot.action('finish_registration', LevelSelectionHandler.handleFinishRegistration);
```

#### 2. Application Layer (src/application/)
**–§–∞–π–ª—ã:** `src/application/use-cases.ts`

**Use Cases:**
- [`registerUser`](src/application/use-cases.ts:352) - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [`updateUserLevel`](src/application/use-cases.ts:391) - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞ –∏–≥—Ä–æ–∫–∞
- [`registerOrganizer`](src/application/use-cases.ts:419) - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞

**–°–µ—Ä–≤–∏—Å—ã:**
- `UserApplicationService` - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `GameApplicationService` - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –∏–≥—Ä–∞–º–∏ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º–∏

#### 3. Infrastructure Layer
**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:**
- `PrismaUserRepo` - –†–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `PrismaOrganizerRepo` - –†–∞–±–æ—Ç–∞ —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º–∏

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
–¢–∞–±–ª–∏—Ü—ã: `users`, `organizers`, `playerOrganizer`

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
**Correlation ID:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `{action}_{userId}_{timestamp}`

**–ü—Ä–∏–º–µ—Ä—ã –∫–ª—é—á–µ–≤—ã—Ö –ª–æ–≥–æ–≤:**
- [`LOG_MESSAGES.BOT.START_COMMAND_INITIATED`](src/bot/registration/registration-handler.ts:23) - –ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã start
- [`LOG_MESSAGES.USE_CASES.REGISTER_USER_PROCESSING`](src/application/use-cases.ts:361) - –ù–∞—á–∞–ª–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [`LOG_MESSAGES.USE_CASES.REGISTER_USER_COMPLETED`](src/application/use-cases.ts:369) - –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
**–ë–∏–∑–Ω–µ—Å-–æ—à–∏–±–∫–∏:**
- `BusinessRuleError` - –ù–∞—Ä—É—à–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª
- `ValidationError` - –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- `NotFoundError` - –°—É—â–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏:**
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º —Å—Ç–µ–∫–æ–º trace
- –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è –Ω–∞ –≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

#### –ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
**registerUser:**
- `telegramId`: –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ
- `name`: –ù–µ–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞, –¥–ª–∏–Ω–∞ 1-100 —Å–∏–º–≤–æ–ª–æ–≤

**updateUserLevel:**
- `userId`: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
- `levelTag`: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ

**registerOrganizer:**
- `userId`: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
- `title`: –ù–µ–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞, –¥–ª–∏–Ω–∞ 1-100 —Å–∏–º–≤–æ–ª–æ–≤

### –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π
```
–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        ‚îÇ
        ‚ñº
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞—á–∞—Ç–∞ (/start)
        ‚îÇ
        ‚ñº
–†–æ–ª—å –≤—ã–±—Ä–∞–Ω–∞
        ‚îÇ
        ‚îú‚îÄ‚ñ∫ –ò–≥—Ä–æ–∫ ‚îÄ‚îÄ‚ñ∫ –£—Ä–æ–≤–µ–Ω—å –≤—ã–±—Ä–∞–Ω ‚îÄ‚îÄ‚ñ∫ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
        ‚îÇ
        ‚îî‚îÄ‚ñ∫ –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä ‚îÄ‚îÄ‚ñ∫ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
```

#### –ü–µ—Ä–µ—Ö–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π
1. **–ù–æ–≤—ã–π ‚Üí –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:** –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ `registerUser`
2. **–ò–≥—Ä–æ–∫ –±–µ–∑ —É—Ä–æ–≤–Ω—è ‚Üí –ò–≥—Ä–æ–∫ —Å —É—Ä–æ–≤–Ω–µ–º:** –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ `updateUserLevel`
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä:** –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ `registerOrganizer`

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤ –ª–æ–≥–∞—Ö

#### –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã `/start`
- –í—Ä–µ–º—è –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏
- –í—Ä–µ–º—è –≤—ã–±–æ—Ä–∞ —É—Ä–æ–≤–Ω—è
- –û–±—â–µ–µ –≤—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

#### –ö–æ–Ω–≤–µ—Ä—Å–∏–æ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–∞—á–∞–≤—à–∏—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
- –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏ –∏–≥—Ä–æ–∫–∞ vs –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞

#### –û—à–∏–±–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ failed —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
- –ù–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –û—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ –ª–æ–≥–∞—Ö

#### INFO —É—Ä–æ–≤–µ–Ω—å
```
[INFO] Registration scenario started for user {telegramId} with correlation {correlationId}
[INFO] User role selected: {role} for user {telegramId}
[INFO] User level updated: {level} for user {telegramId}
[INFO] Registration completed successfully for user {telegramId}
```

#### ERROR —É—Ä–æ–≤–µ–Ω—å
```
[ERROR] Registration failed for user {telegramId}: {errorMessage} correlation: {correlationId}
[ERROR] Database error during user registration: {errorMessage}
[ERROR] Validation failed for user data: {validationErrors}
```

## –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –î—É–±–ª–∏—Ä—É—é—â–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
**–°–∏–º–ø—Ç–æ–º—ã:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `/start` –ø–æ–≤—Ç–æ—Ä–Ω–æ  
**–†–µ—à–µ–Ω–∏–µ:** `registerUser` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º - –ø–æ–≤—Ç–æ—Ä–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
**–°–∏–º–ø—Ç–æ–º—ã:** –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∏–º—è –∏–ª–∏ telegramId  
**–†–µ—à–µ–Ω–∏–µ:** –°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –æ–± –æ—à–∏–±–∫–∞—Ö

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ü–æ—Ç–µ—Ä—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
**–°–∏–º–ø—Ç–æ–º—ã:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–µ—Ä—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏  
**–†–µ—à–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ —Å–µ—Å—Å–∏–∏ –∏–ª–∏ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–±–ª–µ–º–∞ 4: Timeout –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
**–°–∏–º–ø—Ç–æ–º—ã:** –î–ª–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏  
**–†–µ—à–µ–Ω–∏–µ:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 1. –£–ª—É—á—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞ (UX)
**–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä:**
```
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è [‚ñ†‚ñ†‚ñ†‚ñ°‚ñ°] 60%
1. –í—ã–±–æ—Ä —Ä–æ–ª–∏ ‚úì
2. –£—Ä–æ–≤–µ–Ω—å –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞ ‚úì
3. –í—ã–±–æ—Ä –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤ ‚ü≥
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ telegramId –ø—Ä–∏ –≤–≤–æ–¥–µ
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
–ü—Ä–∏–≤–µ—Ç, {name}! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –≤–æ–ª–µ–π–±–æ–ª–∞! üèê
–¢—ã –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –∑–¥–µ—Å—å? –ü–æ–∑–≤–æ–ª—å –ø–æ–º–æ—á—å —Ç–µ–±–µ –Ω–∞—á–∞—Ç—å!
```

### 2. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

#### –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
```typescript
interface RegistrationState {
  userId: string;
  currentStep: 'role' | 'level' | 'organizers' | 'completed';
  selectedRole?: 'player' | 'organizer';
  selectedLevel?: string;
  selectedOrganizers?: string[];
  sessionId: string;
  startedAt: Date;
}
```

#### Rate limiting
–î–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –ù–µ –±–æ–ª–µ–µ 3 –ø–æ–ø—ã—Ç–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ —á–∞—Å –¥–ª—è –æ–¥–Ω–æ–≥–æ telegramId
- –¢–∞–π–º–∞—É—Ç –º–µ–∂–¥—É —à–∞–≥–∞–º–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (15 –º–∏–Ω—É—Ç)

#### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é UI

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞
- CAPTCHA –¥–ª—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

#### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
```typescript
interface UserRegistrationData {
  telegramId: number;
  name: string;
  role: 'player' | 'organizer';
  level?: string;
  organizers?: string[];
}

function validateRegistrationData(data: UserRegistrationData): ValidationResult {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
  // –í–∞–ª–∏–¥–∞—Ü–∏—è telegramId
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –∏–º–µ–Ω–∏
  // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤
}
```

### 4. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏

#### –°–æ–±—ã—Ç–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
```typescript
interface RegistrationAnalytics {
  event: 'registration_started' | 'registration_completed' | 'registration_abandoned';
  userId: string;
  duration: number;
  stepsCompleted: number;
  selectedRole: 'player' | 'organizer';
  selectedLevel?: string;
  selectedOrganizersCount: number;
  source: string; // /start command, deep link, etc.
}
```

#### A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
- –í–∞—Ä–∏–∞–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏
- –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

#### –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –∞–≤–∞—Ç–∞—Ä–∞ –∏–∑ Telegram
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Å–µ—Ç—è–º–∏

#### –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
- –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### 6. –ú–∏–≥—Ä–∞—Ü–∏—è –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

#### –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
```typescript
interface RegistrationSchema {
  version: string;
  migrations: Array<{
    from: string;
    to: string;
    script: string;
  }>;
}
```

#### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 7. –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

#### –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å
```typescript
interface RegistrationTranslations {
  welcomeMessage: Record<string, string>;
  roleOptions: Record<string, { player: string; organizer: string }>;
  levelOptions: Record<string, Record<string, string>>;
  errorMessages: Record<string, string>;
}
```

#### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø–æ–¥ –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

**–ê–≤—Ç–æ—Ä:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è VBallAgregator  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-06  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-06