# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ VBallAgregator

> **–¶–µ–ª—å –¥–æ–∫—É–º–µ–Ω—Ç–∞:** –†–∞–∑–¥–µ–ª–∏—Ç—å –∫–æ–¥ –Ω–∞ —Å–º—ã—Å–ª–æ–≤—ã–µ –±–ª–æ–∫–∏ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –∫–∞—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è-–∫–∞—Ä—Ç–∞-–º–æ–¥—É–ª–µ–π)
2. [–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏](#—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ-—Å—Ü–µ–Ω–∞—Ä–∏–∏)
3. [–°—Ü–µ–Ω–∞—Ä–∏–∏ –∏–≥—Ä–æ–∫–∞](#—Å—Ü–µ–Ω–∞—Ä–∏–∏-–∏–≥—Ä–æ–∫–∞)
4. [–°—Ü–µ–Ω–∞—Ä–∏–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞](#—Å—Ü–µ–Ω–∞—Ä–∏–∏-–æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞)
5. [–ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏](#–ø–ª–∞—Ç–µ–∂–Ω—ã–µ-—Å—Ü–µ–Ω–∞—Ä–∏–∏)
6. [–°–∏—Å—Ç–µ–º–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏](#—Å–∏—Å—Ç–µ–º–Ω—ã–µ-—Å—Ü–µ–Ω–∞—Ä–∏–∏)
7. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –º–æ–¥—É–ª—è–º](#—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è-–ø–æ-–º–æ–¥—É–ª—è–º)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –∫–∞—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π

### Bot Layer (–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
```
src/bot/
‚îú‚îÄ‚îÄ bot.ts                    # –ì–ª–∞–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞
‚îú‚îÄ‚îÄ registration/             # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ registration-handler.ts
‚îÇ   ‚îú‚îÄ‚îÄ level-selection-handler.ts
‚îÇ   ‚îî‚îÄ‚îÄ role-selection-handler.ts
‚îú‚îÄ‚îÄ game-management/          # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ game-management-handler.ts
‚îú‚îÄ‚îÄ payments/                 # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ payment-handler.ts
‚îÇ   ‚îî‚îÄ‚îÄ payment-reminder-handler.ts
‚îú‚îÄ‚îÄ profile/                  # –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ profile-handler.ts
‚îÇ   ‚îî‚îÄ‚îÄ player-management-handler.ts
‚îú‚îÄ‚îÄ settings/                 # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ settings-handler.ts
‚îÇ   ‚îî‚îÄ‚îÄ organizer-selection-handler.ts
‚îú‚îÄ‚îÄ invitations/              # –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ invitation-handler.ts
‚îî‚îÄ‚îÄ common/                   # –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    ‚îú‚îÄ‚îÄ base-handler.ts
    ‚îú‚îÄ‚îÄ callback-parser.ts
    ‚îî‚îÄ‚îÄ keyboard-builder.ts
```

### Application Layer (–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
```
src/application/
‚îú‚îÄ‚îÄ use-cases.ts             # –û—Å–Ω–æ–≤–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ user-service.ts      # –°–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ game-service.ts      # –°–µ—Ä–≤–∏—Å –∏–≥—Ä
‚îî‚îÄ‚îÄ queries/                 # –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
    ‚îú‚îÄ‚îÄ GetUserRegistrationsQuery.ts
    ‚îî‚îÄ‚îÄ GamePaymentsDashboardQuery.ts
```

### Domain Layer (–î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏)
```
src/domain/
‚îú‚îÄ‚îÄ game.ts                  # –ú–æ–¥–µ–ª—å –∏–≥—Ä—ã
‚îú‚îÄ‚îÄ registration.ts          # –ú–æ–¥–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ errors/                  # –°–∏—Å—Ç–µ–º–∞ –æ—à–∏–±–æ–∫
‚îî‚îÄ‚îÄ services/                # –î–æ–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
    ‚îî‚îÄ‚îÄ game-domain-service.ts
```

### Infrastructure Layer (–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
```
src/infrastructure/
‚îú‚îÄ‚îÄ prisma.ts               # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ repositories/           # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ user-repository.ts
‚îÇ   ‚îú‚îÄ‚îÄ game-repository.ts
‚îÇ   ‚îî‚îÄ‚îÄ registration-repository.ts
‚îî‚îÄ‚îÄ health.ts              # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```

---

## üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤–∏—á–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø–æ—Ç–æ–∫:
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /start ‚Üí –í—ã–±–æ—Ä —Ä–æ–ª–∏ ‚Üí [–ò–≥—Ä–æ–∫ ‚Üí –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è ‚Üí –í—ã–±–æ—Ä –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤] ‚Üí [–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä ‚Üí –ü—Ä–æ—Ñ–∏–ª—å] ‚Üí –ì–æ—Ç–æ–≤
```

#### –ö–æ–º–∞–Ω–¥—ã –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
| –≠—Ç–∞–ø | –ö–æ–º–∞–Ω–¥–∞/–î–µ–π—Å—Ç–≤–∏–µ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ | –§–∞–π–ª |
|------|------------------|------------|------|
| –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è | `/start` | `RegistrationHandler.handleStart` | [`src/bot/registration/registration-handler.ts:18`](src/bot/registration/registration-handler.ts:18) |
| –í—ã–±–æ—Ä —Ä–æ–ª–∏ | `role_player` | `LevelSelectionHandler.handleRolePlayer` | [`src/bot/registration/level-selection-handler.ts:18`](src/bot/registration/level-selection-handler.ts:18) |
| –í—ã–±–æ—Ä —Ä–æ–ª–∏ | `role_organizer` | `RegistrationHandler.handleRoleOrganizer` | [`src/bot/registration/registration-handler.ts:45`](src/bot/registration/registration-handler.ts:45) |
| –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è | `level_*` | `LevelSelectionHandler.handleLevelSelection` | [`src/bot/registration/level-selection-handler.ts:45`](src/bot/registration/level-selection-handler.ts:45) |
| –í—ã–±–æ—Ä –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤ | `select_organizers_registration` | `OrganizerSelectionHandler.handleSelectOrganizersRegistration` | [`src/bot/settings/organizer-selection-handler.ts:25`](src/bot/settings/organizer-selection-handler.ts:25) |
| –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ | `finish_registration` | `LevelSelectionHandler.handleFinishRegistration` | [`src/bot/registration/level-selection-handler.ts:85`](src/bot/registration/level-selection-handler.ts:85) |

#### –ë–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏ (Use Cases):
| –û–ø–µ—Ä–∞—Ü–∏—è | –§—É–Ω–∫—Ü–∏—è | –§–∞–π–ª |
|----------|---------|------|
| –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `registerUser` | [`src/application/use-cases.ts:352`](src/application/use-cases.ts:352) |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è | `updateUserLevel` | [`src/application/use-cases.ts:391`](src/application/use-cases.ts:391) |
| –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞ | `registerOrganizer` | [`src/application/use-cases.ts:419`](src/application/use-cases.ts:419) |
| –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º | `selectOrganizers` | [`src/application/use-cases.ts:450`](src/application/use-cases.ts:450) |

#### –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
```typescript
// –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –≤—ã–±–æ—Ä —Ä–æ–ª–∏
'–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤–æ–ª–µ–π–±–æ–ª—å–Ω—ã—Ö –∏–≥—Ä. –í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Ä–æ–ª—å:'
[–ò–≥—Ä–æ–∫] [–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä]

// –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è –¥–ª—è –∏–≥—Ä–æ–∫–∞
'–¢—ã –≤—ã–±—Ä–∞–ª —Ä–æ–ª—å –∏–≥—Ä–æ–∫–∞. –¢–µ–ø–µ—Ä—å –æ—Ü–µ–Ω–∏ —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å:'
[–ù–æ–≤–∏—á–æ–∫] [–õ—é–±–∏—Ç–µ–ª—å] [–û–ø—ã—Ç–Ω—ã–π] [–ü—Ä–æ—Ñ–∏]

// –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
'–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å –∏—Å–∫–∞—Ç—å –∏–≥—Ä—ã –∫–æ–º–∞–Ω–¥–æ–π /games'
```

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)

#### –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏:
```typescript
// src/application/use-cases.ts:361-369
const existingUser = await userRepo.findByTelegramId(telegramId);
if (existingUser) {
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    await userRepo.update(existingUser.id, { name, role });
    return existingUser;
}
```

---

## üéæ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏–≥—Ä–æ–∫–∞

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–æ–∏—Å–∫ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä –∏–≥—Ä

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø–æ—Ç–æ–∫:
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /games ‚Üí –°–ø–∏—Å–æ–∫ –∏–≥—Ä ‚Üí –í—ã–±–æ—Ä –∏–≥—Ä—ã ‚Üí –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```

#### –ö–æ–º–∞–Ω–¥—ã –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
| –î–µ–π—Å—Ç–≤–∏–µ | –ö–æ–º–∞–Ω–¥–∞ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ | –§–∞–π–ª |
|----------|---------|------------|------|
| –°–ø–∏—Å–æ–∫ –∏–≥—Ä | `/games` | `GameManagementHandler.handleGames` | [`src/bot/game-management/game-management-handler.ts:17`](src/bot/game-management/game-management-handler.ts:17) |
| –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–µ | `/game <id>` | `GameManagementHandler.handleGameInfo` | [`src/bot/game-management/game-management-handler.ts:25`](src/bot/game-management/game-management-handler.ts:25) |

#### –ë–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏:
- `listGames()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–≥—Ä –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —É—Ä–æ–≤–Ω—é –∏–≥—Ä–æ–∫–∞
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è

#### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:
```typescript
// –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä—ã
const gameCard = `
üéæ ${formatGameTimeForNotification(game.startsAt)}${level}
${getVenueName(game.venueId)}
${getGameStatusName(game.status)} (${availableSpots} –º–µ—Å—Ç —Å–≤–æ–±–æ–¥–Ω–æ)
ID: \`${game.id}\`
`;
```

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ó–∞–ø–∏—Å—å –Ω–∞ –∏–≥—Ä—É (join)

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø–æ—Ç–æ–∫:
```
–ò–≥—Ä–æ–∫ ‚Üí [–ö–Ω–æ–ø–∫–∞ "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è" / /join <id>] ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π ‚Üí [confirmed/waitlisted]
```

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
| –î–µ–π—Å—Ç–≤–∏–µ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ | –§–∞–π–ª |
|----------|------------|------|
| –ö–æ–º–∞–Ω–¥–∞ `/join` | `GameManagementHandler.handleJoin` | [`src/bot/game-management/game-management-handler.ts:37`](src/bot/game-management/game-management-handler.ts:37) |
| Callback `join_game_*` | `GameManagementHandler.handleGameAction` | [`src/bot/game-management/game-management-handler.ts:72`](src/bot/game-management/game-management-handler.ts:72) |

#### –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:
```typescript
// src/application/use-cases.ts:180-220
const result = await joinGame(gameId, userId);

// –ü—Ä–æ–≤–µ—Ä–∫–∏:
// 1. –ò–≥—Ä–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –æ—Ç–∫—Ä—ã—Ç–∞
// 2. –ò–≥—Ä–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ
// 3. –ù–µ –∑–∞–ø–∏—Å–∞–Ω –Ω–∞ –∏–≥—Ä—É
// 4. –ï—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ –º–µ—Å—Ç–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ª–∏—Å—Ç –æ–∂–∏–¥–∞–Ω–∏—è
```

#### –°–æ—Å—Ç–æ—è–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
- `confirmed` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –∑–∞–ø–∏—Å—å
- `waitlisted` - –≤ –ª–∏—Å—Ç–µ –æ–∂–∏–¥–∞–Ω–∏—è
- `canceled` - –æ—Ç–º–µ–Ω–µ–Ω–∞

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 5: –û—Ç–º–µ–Ω–∞ —É—á–∞—Å—Ç–∏—è (leave)

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø–æ—Ç–æ–∫:
```
–ò–≥—Ä–æ–∫ ‚Üí [–ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∏—Ç—å" / /leave <id>] ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –°—Ç–∞—Ç—É—Å canceled ‚Üí –ê–≤—Ç–æ–ø—Ä–æ–º–æ—É—à–µ–Ω —Å–ª–µ–¥—É—é—â–µ–≥–æ
```

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
| –î–µ–π—Å—Ç–≤–∏–µ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ | –§–∞–π–ª |
|----------|------------|------|
| –ö–æ–º–∞–Ω–¥–∞ `/leave` | `GameManagementHandler.handleLeave` | [`src/bot/game-management/game-management-handler.ts:57`](src/bot/game-management/game-management-handler.ts:57) |
| Callback `leave_game_*` | `GameManagementHandler.handleGameAction` | [`src/bot/game-management/game-management-handler.ts:72`](src/bot/game-management/game-management-handler.ts:72) |

#### –ê–≤—Ç–æ–ø—Ä–æ–º–æ—É—à–µ–Ω:
```typescript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –ø–µ—Ä–≤–æ–≥–æ –∏–∑ waitlist –≤ confirmed
if (nextInWaitlist) {
    await updateRegistration(nextInWaitlist.id, { status: 'confirmed' });
    await notifyPlayer(nextInWaitlist.userId, '–ú–µ—Å—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ!');
}
```

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 6: –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–∏—á–Ω—ã—Ö –∏–≥—Ä

#### –ö–æ–º–∞–Ω–¥–∞: `/my`

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `CommandHandlers.handleMy` ([`src/bot/command-handlers.ts:223`](src/bot/command-handlers.ts:223))

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä –∫–∞–∫ —É—á–∞—Å—Ç–Ω–∏–∫–∞
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä (–¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤)
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
- –°—Ç–∞—Ç—É—Å—ã –æ–ø–ª–∞—Ç—ã –∏ —É—á–∞—Å—Ç–∏—è

#### –ó–∞–ø—Ä–æ—Å—ã –¥–∞–Ω–Ω—ã—Ö:
```typescript
// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–∞–∫ –∏–≥—Ä–æ–∫
const playerQuery = new GetUserRegistrationsQuery(user.id);
const playerRegistrations = await playerQuery.execute();

// –ò–≥—Ä—ã –∫–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
const organizerGames = await prisma.game.findMany({
    where: { organizerId: organizer.id },
    include: { registrations: { include: { user: true } } }
});
```

---

## üëë –°—Ü–µ–Ω–∞—Ä–∏–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 7: –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø–æ—Ç–æ–∫:
```
–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä ‚Üí /newgame ‚Üí –ú–∞—Å—Ç–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è (–î–∞—Ç–∞ ‚Üí –í—Ä–µ–º—è ‚Üí –£—Ä–æ–≤–µ–Ω—å ‚Üí –ü–ª–æ—â–∞–¥–∫–∞ ‚Üí –í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å ‚Üí –¶–µ–Ω–∞) ‚Üí –ò–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞
```

#### –ú–∞—Å—Ç–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è: `GameCreationWizard` ([`src/bot/game-creation-wizard.ts`](src/bot/game-creation-wizard.ts))

#### –≠—Ç–∞–ø—ã —Å–æ–∑–¥–∞–Ω–∏—è:
1. **–í—ã–±–æ—Ä –¥–∞—Ç—ã** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `handleDateSelection`
2. **–í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `handleTimeSelection`  
3. **–í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `handleLevelSelection`
4. **–í—ã–±–æ—Ä –ø–ª–æ—â–∞–¥–∫–∏** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `handleVenueSelection`
5. **–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `handleCapacitySelection`
6. **–¶–µ–Ω–∞** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `handlePriceSelection`

#### Callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
```typescript
// src/bot/bot.ts:149-178
bot.action(/^wizard_date_(.+)$/, async (ctx) => {
    const dateKey = ctx.match[1];
    await GameCreationWizard.handleDateSelection(ctx, dateKey);
});
// ... –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –¥—Ä—É–≥–∏—Ö —ç—Ç–∞–ø–æ–≤
```

#### –ë–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏—è:
- `createGame()` - —Å–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 8: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å—å—é –Ω–∞ –∏–≥—Ä—ã

#### –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
| –ö–æ–º–∞–Ω–¥–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ |
|---------|------------|------------|
| `/close <id>` | –ó–∞–∫—Ä—ã—Ç—å –∑–∞–ø–∏—Å—å | `GameManagementHandler.handleClose` |
| `/payments <id>` | –°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç | `CommandHandlers.handlePayments` |

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- –ó–∞–∫—Ä—ã—Ç–∏–µ/–æ—Ç–∫—Ä—ã—Ç–∏–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∏–≥—Ä—É
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
- –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 9: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏

#### –ö–æ–º–∞–Ω–¥—ã:
| –ö–æ–º–∞–Ω–¥–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –§–∞–π–ª |
|---------|------------|------|
| `/myplayers` | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∏ | [`src/bot/command-handlers.ts:558`](src/bot/command-handlers.ts:558) |
| `/pendingplayers` | –û–∂–∏–¥–∞—é—â–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è | [`src/bot/command-handlers.ts:589`](src/bot/command-handlers.ts:589) |

#### –û–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:
```typescript
// –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
bot.action(/^confirm_player_(.+)$/, async (ctx) => {
    await PlayerManagementHandler.handleConfirmPlayer(ctx, ctx.match[0]);
});

// –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞  
bot.action(/^reject_player_(.+)$/, async (ctx) => {
    await PlayerManagementHandler.handleRejectPlayer(ctx, ctx.match[0]);
});
```

#### –ë–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏:
- `confirmPlayer(organizerId, playerId)`
- `rejectPlayer(organizerId, playerId)`
- `getOrganizerPlayers(organizerId, status)`

---

## üí∞ –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 10: –û—Ç–º–µ—Ç–∫–∞ –æ–ø–ª–∞—Ç—ã –∏–≥—Ä–æ–∫–æ–º

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø–æ—Ç–æ–∫:
```
–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å ‚Üí –û–∫–Ω–æ –æ–ø–ª–∞—Ç—ã –æ—Ç–∫—Ä—ã—Ç–æ ‚Üí –ò–≥—Ä–æ–∫ ‚Üí [–ö–Ω–æ–ø–∫–∞ "–û–ø–ª–∞—Ç–∏–ª" / /pay <id>] ‚Üí –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞
```

#### –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- **–î–æ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã** - –∫–Ω–æ–ø–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞
- **–ü–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ (`startsAt`)** - –∫–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è
- **–†—É—á–Ω–∞—è –æ—Ç–º–µ—Ç–∫–∞** - –∏–≥—Ä–æ–∫ —Å–∞–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—É

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
| –î–µ–π—Å—Ç–≤–∏–µ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ | –§–∞–π–ª |
|----------|------------|------|
| –ö–æ–º–∞–Ω–¥–∞ `/pay` | `GameManagementHandler.handlePay` | [`src/bot/game-management/game-management-handler.ts:42`](src/bot/game-management/game-management-handler.ts:42) |
| Callback `pay_game_*` | `GameManagementHandler.handleGameAction` | [`src/bot/game-management/game-management-handler.ts:90`](src/bot/game-management/game-management-handler.ts:90) |

#### –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:
```typescript
// src/application/use-cases.ts:280-320
if (now() < game.startsAt) {
    throw new BusinessRuleError('PAYMENT_WINDOW_NOT_OPEN');
}
await updateRegistration(userId, gameId, { 
    paymentStatus: 'paid', 
    paymentMarkedAt: now() 
});
```

#### –°—Ç–∞—Ç—É—Å—ã –æ–ø–ª–∞—Ç—ã:
- `unpaid` - –Ω–µ –æ–ø–ª–∞—á–µ–Ω–æ
- `paid` - –æ–ø–ª–∞—á–µ–Ω–æ

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 11: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–ø–ª–∞—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–º

#### –ö–æ–º–∞–Ω–¥–∞: `/payments <game_id>`

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `CommandHandlers.handlePayments` ([`src/bot/command-handlers.ts:360`](src/bot/command-handlers.ts:360))

#### –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å: `GamePaymentsDashboardQuery` ([`src/application/queries/GamePaymentsDashboardQuery.ts`](src/application/queries/GamePaymentsDashboardQuery.ts))

#### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:
```typescript
const dashboard = await query.execute();
const payments = dashboard.players.map(player => 
    `${player.name}: ${getPaymentStatusName(player.paymentStatus)}`
).join('\n');
```

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ–ø–ª–∞—Ç–∞–º
- –°–ø–∏—Å–æ–∫ –Ω–µ–æ–ø–ª–∞—Ç–∏–≤—à–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
- –ö–Ω–æ–ø–∫–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 12: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± –æ–ø–ª–∞—Ç–µ

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:
- –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –æ–∫–Ω–∞ –æ–ø–ª–∞—Ç—ã (`startsAt`)
- –ó–∞ 2 —á–∞—Å–∞ –¥–æ –∏–≥—Ä—ã (–µ—Å–ª–∏ –Ω–µ –æ–ø–ª–∞—á–µ–Ω–æ)
- –ü–æ –∑–∞–ø—Ä–æ—Å—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–∞—Å—Å–æ–≤—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π: `PaymentReminderHandler` ([`src/bot/payments/payment-reminder-handler.ts`](src/bot/payments/payment-reminder-handler.ts))

#### Callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:
```typescript
bot.action(/^remind_payments_(.+)$/, async (ctx) => {
    await PaymentReminderHandler.handleRemindPaymentsCallback(ctx, ctx.match[0]);
});
```

---

## ‚öôÔ∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 13: –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
1. **–ò–≥—Ä–æ–≤—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:**
   - T-24 —á–∞—Å–∞ –¥–æ –∏–≥—Ä—ã
   - T-2 —á–∞—Å–∞ –¥–æ –∏–≥—Ä—ã
   - –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã (–æ—Ç–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ –æ–ø–ª–∞—Ç—ã)

2. **–ü–ª–∞—Ç–µ–∂–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
   - –û—Ç–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ –æ–ø–ª–∞—Ç—ã
   - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –Ω–µ–æ–ø–ª–∞—Ç–µ

3. **–°–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–∑ –ª–∏—Å—Ç–∞ –æ–∂–∏–¥–∞–Ω–∏—è
   - –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∏–≥—Ä—ã
   - –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: `userPreferencesService` ([`src/shared/user-preferences-service.ts`](src/shared/user-preferences-service.ts))

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫:
```typescript
interface UserPreferences {
    globalNotifications: boolean;
    paymentRemindersAuto: boolean;
    paymentRemindersManual: boolean;
    gameReminders24h: boolean;
    gameReminders2h: boolean;
    organizerNotifications: boolean;
}
```

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 14: –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á

#### –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: `scheduler-service.ts` ([`src/shared/scheduler-service.ts`](src/shared/scheduler-service.ts))

#### –¢–∏–ø—ã –∑–∞–¥–∞—á:
1. **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± –∏–≥—Ä–∞—Ö**
2. **–û—Ç–∫—Ä—ã—Ç–∏–µ –æ–∫–æ–Ω –æ–ø–ª–∞—Ç—ã**
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –∏–≥—Ä**
4. **–û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö**

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞:
```typescript
interface ScheduledTask {
    id: string;
    type: 'reminder_24h' | 'reminder_2h' | 'payment_window' | 'cleanup';
    gameId: string;
    scheduledAt: Date;
    executed: boolean;
}
```

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 15: –°–∏—Å—Ç–µ–º–∞ –æ—à–∏–±–æ–∫ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

#### –ò–µ—Ä–∞—Ä—Ö–∏—è –æ—à–∏–±–æ–∫: `src/domain/errors/` ([`src/domain/errors/index.ts`](src/domain/errors/index.ts))

```typescript
abstract class DomainError extends Error {
    abstract code: string;
    abstract httpStatus: number;
}

class BusinessRuleError extends DomainError {
    code = 'BUSINESS_RULE_VIOLATION';
}

class ValidationError extends DomainError {
    code = 'VALIDATION_FAILED';
}
```

#### –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥: `CommandValidator` ([`src/bot/common/command-validator.ts`](src/bot/common/command-validator.ts))

#### –ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
- –§–æ—Ä–º–∞—Ç UUID –¥–ª—è ID –∏–≥—Ä
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –º–æ–¥—É–ª—è–º

### üì± Bot Layer - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª: `src/bot/bot.ts` ([`src/bot/bot.ts`](src/bot/bot.ts))

```typescript
// –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
bot.start(RegistrationHandler.handleStart);
bot.command('games', GameManagementHandler.handleGames);
bot.command('join', async (ctx) => {
    const gameId = await CommandValidator.validateAndExtractGameId(ctx, 'join');
    await GameManagementHandler.handleJoin(ctx, gameId);
});

// Callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏
bot.action(/^join_game_(.+)$/, async (ctx) => {
    await GameManagementHandler.handleGameAction(ctx, ctx.match[0] ?? '');
});
```

#### Rate Limiting: `telegraf-ratelimit`
```typescript
const limitConfig = { in: 2, out: 1, unique: true };
bot.use(rateLimit(limitConfig)); // 2 —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥—É
```

### üß† Application Layer - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

#### –û—Å–Ω–æ–≤–Ω—ã–µ Use Cases: `src/application/use-cases.ts` ([`src/application/use-cases.ts`](src/application/use-cases.ts))

| –§—É–Ω–∫—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –°–≤—è–∑–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ |
|---------|------------|-------------------|
| `registerUser` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | –°—Ü–µ–Ω–∞—Ä–∏–π 1, 2 |
| `joinGame` | –ó–∞–ø–∏—Å—å –Ω–∞ –∏–≥—Ä—É | –°—Ü–µ–Ω–∞—Ä–∏–π 4 |
| `leaveGame` | –û—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏ | –°—Ü–µ–Ω–∞—Ä–∏–π 5 |
| `markPayment` | –û—Ç–º–µ—Ç–∫–∞ –æ–ø–ª–∞—Ç—ã | –°—Ü–µ–Ω–∞—Ä–∏–π 10 |
| `createGame` | –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã | –°—Ü–µ–Ω–∞—Ä–∏–π 7 |
| `listGames` | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–≥—Ä | –°—Ü–µ–Ω–∞—Ä–∏–π 3 |

#### –°–µ—Ä–≤–∏—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- `UserApplicationService` - –ª–æ–≥–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `GameApplicationService` - –ª–æ–≥–∏–∫–∞ –∏–≥—Ä

#### –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
- `GetUserRegistrationsQuery` - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `GamePaymentsDashboardQuery` - –¥–∞—à–±–æ—Ä–¥ –æ–ø–ª–∞—Ç

### üèóÔ∏è Domain Layer - –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

#### –ö–ª—é—á–µ–≤—ã–µ –º–æ–¥–µ–ª–∏:

##### –ú–æ–¥–µ–ª—å –∏–≥—Ä—ã: `src/domain/game.ts`
```typescript
interface Game {
    id: string;
    organizerId: string;
    startsAt: Date;
    venueId: string;
    levelTag?: string;
    capacity: number;
    priceText?: string;
    status: 'open' | 'closed' | 'cancelled';
}
```

##### –ú–æ–¥–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: `src/domain/registration.ts`
```typescript
interface Registration {
    id: string;
    gameId: string;
    userId: string;
    status: 'confirmed' | 'waitlisted' | 'canceled';
    paymentStatus: 'unpaid' | 'paid';
    paymentMarkedAt?: Date;
}
```

#### –î–æ–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:
- `GameDomainService` - –¥–æ–º–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∏–≥—Ä

### üóÑÔ∏è Infrastructure Layer - –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: Prisma ORM

##### –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö:
```prisma
model User {
    id          String   @id @default(uuid())
    telegramId  Int      @unique
    name        String
    role        Role
    levelTag    String?
    createdAt   DateTime @default(now())
}

model Game {
    id          String   @id @default(uuid())
    organizerId String
    startsAt    DateTime
    venueId     String
    levelTag    String?
    capacity    Int
    priceText   String?
    status      GameStatus @default(OPEN)
    createdAt   DateTime @default(now())
}

model Registration {
    id              String @id @default(uuid())
    gameId          String
    userId          String
    status          RegistrationStatus
    paymentStatus   PaymentStatus @default(UNPAID)
    paymentMarkedAt DateTime?
    createdAt       DateTime @default(now())
}
```

#### –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏: `src/infrastructure/repositories/`

| –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –°–≤—è–∑–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |
|-------------|------------|-------------------|
| `UserRepository` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ | registerUser, updateUserLevel |
| `GameRepository` | –ò–≥—Ä—ã | createGame, listGames, findById |
| `RegistrationRepository` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ | joinGame, leaveGame, findByGame |

### üîó Shared Layer - –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: `enhanced-logger.ts` ([`src/shared/enhanced-logger.ts`](src/shared/enhanced-logger.ts))

```typescript
// –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å correlation ID
logger.info('User registration started', {
    correlationId: generateCorrelationId(),
    userTelegramId: telegramId,
    action: 'REGISTER_USER'
});
```

#### –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: `notification-service.ts` ([`src/shared/notification-service.ts`](src/shared/notification-service.ts))

```typescript
interface NotificationMessage {
    type: 'game_reminder' | 'payment_reminder' | 'system';
    recipient: string;
    message: string;
    actionUrl?: string;
}
```

#### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö: `input-validator.ts` ([`src/shared/input-validator.ts`](src/shared/input-validator.ts))

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã `/start`
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏ –∏–≥—Ä–æ–∫–∞ vs –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞

#### –ò–≥—Ä–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –Ω–∞ –∏–≥—Ä—É
- –í—Ä–µ–º—è –¥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∏–≥—Ä—ã
- –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–º–µ–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π

#### –ü–ª–∞—Ç–µ–∂–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- –í—Ä–µ–º—è –æ—Ç –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã –¥–æ –æ—Ç–º–µ—Ç–∫–∏ –æ–ø–ª–∞—Ç—ã
- –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–µ–æ–ø–ª–∞—Ç–∏–≤—à–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

### –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

#### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
- `DEBUG` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `INFO` - –∫–ª—é—á–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `WARN` - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- `ERROR` - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥-–∑–∞–ø–∏—Å–µ–π:
```json
{
    "timestamp": "2025-11-06T00:51:27.752Z",
    "level": "INFO",
    "correlationId": "REG_USER_12345_1730847087752",
    "action": "USER_REGISTRATION_COMPLETED",
    "userId": "user_uuid",
    "duration": 2500,
    "success": true
}
```

---

## üöÄ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–î–∞–Ω–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ VBallAgregator —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∫–æ–¥–∞. –î–æ–∫—É–º–µ–Ω—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è:

- **–ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** - –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–µ–π
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø–∏—Å–∞—Ç–µ–ª–µ–π** - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **–°–∏—Å—Ç–µ–º–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤** - –∞–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- **DevOps –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞ —Å–∏—Å—Ç–µ–º—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–ª–æ—è–º (Bot/Application/Domain/Infrastructure)
2. **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π** - –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
4. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –ª–µ–≥–∫–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é:

- –î–æ–±–∞–≤–∏—Ç—å A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è UX —É–ª—É—á—à–µ–Ω–∏–π
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –º–µ—Ç—Ä–∏–∫ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –í–Ω–µ–¥—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- –°–æ–∑–¥–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–ª—é—á–µ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

---

**–ê–≤—Ç–æ—Ä:** VBallAgregator Team  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-06  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é  