# –†–µ–≤—å—é –∫–æ–¥–∞: –ù–µ–¥–µ–ª—è 1 (–§—É–Ω–¥–∞–º–µ–Ω—Ç)

**–î–∞—Ç–∞**: 2025-11-03  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º  
**–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞**: 7.5/10

---

## üìã –ö–æ–Ω—Ç–µ–∫—Å—Ç

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–≤–æ–≥–æ —à–∞–≥–∞ –ø–æ—à–∞–≥–æ–≤–æ–≥–æ –ø–ª–∞–Ω–∞ (–ù–µ–¥–µ–ª—è 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –±–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞). –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤–∫–ª—é—á–∞–ª–∏:
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ (Node.js + TypeScript + Prisma)
- ‚úÖ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ PostgreSQL
- ‚úÖ Telegram Bot (–∫–æ–º–∞–Ω–¥–∞ /start)
- ‚úÖ CI/CD pipeline

---

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Ö–æ—Ä–æ—à–æ

### 1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞**

| –ê—Å–ø–µ–∫—Ç | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|--------|--------|-----------|
| –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å | 8/10 | –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: domain ‚Üí application ‚Üí infrastructure |
| DDD –ø–æ–¥—Ö–æ–¥ | 8/10 | –ü—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–¥–µ–ª–µ–Ω—ã –∞–≥—Ä–µ–≥–∞—Ç—ã (Game, Registration) |
| –¢–∏–ø–∏–∑–∞—Ü–∏—è | 8/10 | TypeScript –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ |
| –°–ª–æ–∏ | 8/10 | –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ |

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
src/
‚îú‚îÄ‚îÄ domain/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (Game, Registration, errors)
‚îú‚îÄ‚îÄ application/     # Use cases (joinGame, leaveGame, markPayment)
‚îú‚îÄ‚îÄ infrastructure/  # Prisma, repositories
‚îî‚îÄ‚îÄ shared/          # Event publisher, types
```

### 2. **–î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å**

**[`src/domain/game.ts`](src/domain/game.ts)** - –û—Ç–ª–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–¥–µ–ª–µ–Ω—ã –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ (`ensureCanJoin`)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–Ω–∞ –æ–ø–ª–∞—Ç—ã (`isPaymentWindowOpen`)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –∏–≥—Ä—ã
- ‚úÖ –ù–µ–∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å ID –∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–ª–µ–π

**[`src/domain/registration.ts`](src/domain/registration.ts)** - –•–æ—Ä–æ—à–æ:
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ `markPaid(game)`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–Ω–∞ –æ–ø–ª–∞—Ç—ã –≤ –¥–æ–º–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–µ
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏

### 3. **–°—Ö–µ–º–∞ –ë–î**

**[`prisma/schema.prisma`](prisma/schema.prisma)** - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã users, organizers, games, registrations
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ (1:N, N:N)
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (`@@index([gameId, status, createdAt])`)
- ‚úÖ –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (`@@unique([gameId, userId])`)

### 4. **Telegram Bot**

**[`src/bot.ts`](src/bot.ts)** - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω:
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `/start` —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –í—ã–±–æ—Ä —Ä–æ–ª–∏ (–∏–≥—Ä–æ–∫/–æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä)
- ‚úÖ –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è –∏–≥—Ä–æ–∫–∞
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã `/games`, `/join`, `/leave`, `/pay`, `/newgame`, `/my`
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

### 5. **Use Cases**

**[`src/application/use-cases.ts`](src/application/use-cases.ts)** - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ª–æ–≥–∏–∫–∞:
- ‚úÖ `joinGame` —Å advisory lock –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è race conditions
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ (confirmed/waitlisted)
- ‚úÖ `leaveGame` —Å –∞–≤—Ç–æ–ø—Ä–æ–º–æ—É—à–µ–Ω–æ–º –∏–∑ waitlist
- ‚úÖ `markPayment` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –æ–∫–Ω–∞ –æ–ø–ª–∞—Ç—ã
- ‚úÖ Event publishing –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### 6. **–¢–µ—Å—Ç—ã**

**[`src/tests/use-cases.test.ts`](src/tests/use-cases.test.ts)** - –•–æ—Ä–æ—à–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:
- ‚úÖ –¢–µ—Å—Ç—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (joinGame, leaveGame, markPayment)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ waitlist –º–µ—Ö–∞–Ω–∏–∫–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–Ω–∞ –æ–ø–ª–∞—Ç—ã
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ Cleanup –≤ beforeEach/afterEach

### 7. **CI/CD Pipeline**

**[`.github/workflows/ci.yml`](.github/workflows/ci.yml)** - –ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω:
- ‚úÖ PostgreSQL —Å–µ—Ä–≤–∏—Å –≤ GitHub Actions
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- ‚úÖ Linter –≤ pipeline

### 8. **Docker**

**[`docker-compose.yml`](docker-compose.yml)** - –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:
- ‚úÖ PostgreSQL 15
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ë–î
- ‚úÖ Volumes –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –∏ —É–ª—É—á—à–µ–Ω–∏—è

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. **–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ bot.ts (—Å—Ç—Ä–æ–∫–∞ 201-202)**

**–ü—Ä–æ–±–ª–µ–º–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ `venue_` action.

```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (—Å—Ç—Ä–æ–∫–∞ 201-202)
    await ctx.editMessageText(`–ò–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞! ID: \`${game.id}\`\n\n–†–∞—Å—Å–∫–∞–∂–∏ –¥—Ä—É–∑—å—è–º...`);
  } catch (error: any) {
    await ctx.editMessageText(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä—ã: ${error.message}`);
  }
bot.on('text', async (ctx) => {  // ‚Üê –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞ –≤—ã—à–µ
```

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å `});` –ø–µ—Ä–µ–¥ `bot.on('text')`

#### 2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤ repositories.ts**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `as any` –≤–º–µ—Å—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏.

```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
game.status as any  // –°—Ç—Ä–æ–∫–∞ 31, 51, 59
reg.status as any   // –°—Ç—Ä–æ–∫–∞ 74, 85, 93, 103, 121
```

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã:
```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
game.status as GameStatus
reg.status as RegStatus
```

#### 3. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ bot.ts**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è –±–æ—Ç–∞.

```typescript
// ‚ùå –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
bot.launch();
```

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:
```typescript
bot.catch((err, ctx) => {
  console.error('Bot error:', err);
  ctx.reply('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ.');
});
```

---

### üü° –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 4. **Advisory lock –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ gameId –≤ —á–∏—Å–ª–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∫–æ–ª–ª–∏–∑–∏—è–º.

```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (—Å—Ç—Ä–æ–∫–∞ 23)
const lockId = gameId.split('').reduce((a, b) => a + b.charCodeAt(0), 0);
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø–ª–æ—Ö–æ**:
- –†–∞–∑–Ω—ã–µ UUID –º–æ–≥—É—Ç –¥–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π lockId
- –ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö–µ—à –∏–ª–∏ –ø—Ä—è–º–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ:
```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
import { createHash } from 'crypto';
const lockId = parseInt(createHash('md5').update(gameId).digest('hex').slice(0, 8), 16);
// –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É –∫–∞–∫ –µ—Å—Ç—å
await tx.$executeRaw`SELECT pg_advisory_xact_lock(hashtext(${gameId}))`;
```

#### 5. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ use-cases.

```typescript
// ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
export async function joinGame(gameId: string, userId: string) {
  // –ß—Ç–æ –µ—Å–ª–∏ gameId –∏–ª–∏ userId –ø—É—Å—Ç—ã?
}
```

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é:
```typescript
export async function joinGame(gameId: string, userId: string) {
  if (!gameId?.trim()) throw new DomainError('INVALID_INPUT', 'gameId –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º');
  if (!userId?.trim()) throw new DomainError('INVALID_INPUT', 'userId –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º');
  // ...
}
```

#### 6. **Event publisher —Ç–æ–ª—å–∫–æ in-memory**

**–ü—Ä–æ–±–ª–µ–º–∞**: –°–æ–±—ã—Ç–∏—è —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

```typescript
// ‚ùå –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
export const eventPublisher = new InMemoryEventPublisher();
```

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è –±—É–¥—É—â–µ–≥–æ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –∏–ª–∏ –æ—á–µ—Ä–µ–¥—å (BullMQ –ø–æ –ø–ª–∞–Ω—É).

#### 7. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.

```typescript
// ‚ùå –ù–µ—Ç –ª–æ–≥–æ–≤
export async function joinGame(gameId: string, userId: string) {
  // –ö–∞–∫ –æ—Ç—Å–ª–µ–¥–∏—Ç—å —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ?
}
```

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```typescript
import { logger } from '../shared/logger.js';

export async function joinGame(gameId: string, userId: string) {
  logger.info('joinGame', { gameId, userId });
  try {
    // ...
  } catch (error) {
    logger.error('joinGame failed', { gameId, userId, error });
    throw error;
  }
}
```

---

### üü¢ –ú–∏–Ω–æ—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 8. **Hardcoded –∑–Ω–∞—á–µ–Ω–∏—è –≤ bot.ts**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–ª–æ—â–∞–¥–∫–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–≥—Ä—ã –∑–∞—Ö–∞—Ä–¥–∫–æ–¥–µ–Ω—ã.

```typescript
// ‚ùå Hardcoded (—Å—Ç—Ä–æ–∫–∏ 159-161)
[{ text: '–°—Ç–∞–¥–∏–æ–Ω "–í–æ–ª–Ω–∞"', callback_data: 'venue_volna' }],
[{ text: '–°–ö "–û–ª–∏–º–ø"', callback_data: 'venue_olimp' }],
[{ text: '–ü–∞—Ä–∫ "–Æ–∂–Ω—ã–π"', callback_data: 'venue_south' }]

// ‚ùå Hardcoded –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Å—Ç—Ä–æ–∫–∏ 193-195)
capacity: 12,
levelTag: 'amateur',
priceText: '500‚ÇΩ'
```

**–†–µ—à–µ–Ω–∏–µ**: –í—ã–Ω–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Ñ–∏–≥ –∏–ª–∏ –ë–î:
```typescript
const VENUES = [
  { id: 'venue-volna-id', name: '–°—Ç–∞–¥–∏–æ–Ω "–í–æ–ª–Ω–∞"' },
  { id: 'venue-olimp-id', name: '–°–ö "–û–ª–∏–º–ø"' },
  { id: 'venue-south-id', name: '–ü–∞—Ä–∫ "–Æ–∂–Ω—ã–π"' }
];
```

#### 9. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ edge cases**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null/undefined –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö.

```typescript
// ‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å null (—Å—Ç—Ä–æ–∫–∞ 42)
const user = await prisma.user.findUnique({ where: { telegramId } });
if (!user || !user.id) {  // user.id –≤—Å–µ–≥–¥–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –µ—Å–ª–∏ user –Ω–µ null
  return ctx.editMessageText('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
}
```

**–†–µ—à–µ–Ω–∏–µ**: –£–ø—Ä–æ—Å—Ç–∏—Ç—å:
```typescript
const user = await prisma.user.findUnique({ where: { telegramId } });
if (!user) {
  return ctx.editMessageText('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
}
```

#### 10. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ use-cases –∏ –∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (—É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ –µ—Å—Ç—å, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å).

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –ø–ª–∞–Ω–∞

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-----------|
| Node.js + TypeScript + Prisma | ‚úÖ | –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è | ‚úÖ | docker-compose.yml –≥–æ—Ç–æ–≤ |
| –°—Ö–µ–º–∞ PostgreSQL | ‚úÖ | –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã |
| Telegram Bot /start | ‚úÖ | –†–∞–±–æ—Ç–∞–µ—Ç —Å –≤—ã–±–æ—Ä–æ–º —Ä–æ–ª–∏ |
| CI/CD pipeline | ‚úÖ | GitHub Actions –Ω–∞—Å—Ç—Ä–æ–µ–Ω |
| –õ–æ–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–Ω–¥ | ‚úÖ | –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ docker-compose |
| –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ /start | ‚úÖ | –î–∞, —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π |
| –ë–î —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞ | ‚úÖ | PostgreSQL –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º

### üî¥ –°—Ä–æ—á–Ω–æ (–¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫–æ–º–º–∏—Ç–∞)

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É –≤ bot.ts** (—Å—Ç—Ä–æ–∫–∞ 201)
   - –î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫—Ä—ã–≤–∞—é—â—É—é —Å–∫–æ–±–∫—É –¥–ª—è `venue_` action
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è

2. **–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ bot.ts**
   - –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `bot.catch()`
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

3. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–∏–ø–∏–∑–∞—Ü–∏—é –≤ repositories.ts**
   - –ó–∞–º–µ–Ω–∏—Ç—å `as any` –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å TypeScript compiler –≤ strict —Ä–µ–∂–∏–º–µ

### üü° –í–∞–∂–Ω–æ (–≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏)

4. **–£–ª—É—á—à–∏—Ç—å advisory lock**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
   - –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –Ω–∞ race conditions

5. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ UUID

6. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –°–æ–∑–¥–∞—Ç—å shared/logger.ts
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ (–≤ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏)

7. **–í—ã–Ω–µ—Å—Ç–∏ hardcoded –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥**
   - –°–æ–∑–¥–∞—Ç—å config/venues.ts
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

8. **–î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**
   - README —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –∑–∞–ø—É—Å–∫–∞
   - API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

9. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É edge cases**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ null/undefined
   - –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –Ω–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏

---

## üß™ –ö–∞—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤

| –ú–µ—Ç—Ä–∏–∫–∞ | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---------|--------|-----------|
| –ü–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π | 8/10 | joinGame, leaveGame, markPayment –ø–æ–∫—Ä—ã—Ç—ã |
| –ü–æ–∫—Ä—ã—Ç–∏–µ edge cases | 6/10 | –ù—É–∂–Ω—ã —Ç–µ—Å—Ç—ã –Ω–∞ race conditions |
| –ü–æ–∫—Ä—ã—Ç–∏–µ –æ—à–∏–±–æ–∫ | 7/10 | –û—Å–Ω–æ–≤–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã | 5/10 | –ï—Å—Ç—å, –Ω–æ –Ω—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å |

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å**:
- –¢–µ—Å—Ç—ã –Ω–∞ race conditions (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ joinGame)
- –¢–µ—Å—Ç—ã –Ω–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ –≤—Ä–µ–º–µ–Ω–∏
- –¢–µ—Å—Ç—ã –Ω–∞ –±–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

```
–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:        ‚úÖ 9/10
–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:           ‚úÖ 8/10
–¢–∏–ø–∏–∑–∞—Ü–∏—è:             ‚ö†Ô∏è  7/10 (as any)
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:          ‚úÖ 7/10
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:          ‚ö†Ô∏è  5/10
–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:      ‚ö†Ô∏è  6/10
–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:           ‚ùå 2/10
–í–∞–ª–∏–¥–∞—Ü–∏—è:             ‚ö†Ô∏è  5/10
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–¢–û–ì–û:                 6.9/10
```

---

## ‚ú® –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –æ—Ç–ª–∏—á–Ω–æ

1. **DDD –ø–æ–¥—Ö–æ–¥** - –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –¥–æ–º–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏
2. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤
3. **–°—Ö–µ–º–∞ –ë–î** - –•–æ—Ä–æ—à–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
4. **Use cases** - –õ–æ–≥–∏–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è, –≤–∫–ª—é—á–∞—è race condition protection
5. **–¢–µ—Å—Ç—ã** - –ü–æ–∫—Ä—ã–≤–∞—é—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
6. **CI/CD** - –ù–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –î–ª—è –ù–µ–¥–µ–ª–∏ 2 (–î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å Users)

1. –†–∞—Å—à–∏—Ä–∏—Ç—å User –º–æ–¥–µ–ª—å (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
2. –î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ø—Ä–∏–≤—è–∑–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è –∏–≥—Ä–æ–∫–∞

### –î–ª—è –ù–µ–¥–µ–ª–∏ 3 (–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–≤—è–∑–æ–∫)

1. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É PlayerOrganizer (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞)
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å linkPlayerToOrganizer use case
3. –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—É

### –û–±—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. –î–æ–±–∞–≤–∏—Ç—å Redis –¥–ª—è event sourcing
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å BullMQ –¥–ª—è –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á
3. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Sentry)
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (Winston)

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ù–µ–¥–µ–ª–∏ 1 —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –Ω–∞ 85%.**

–û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è, –Ω–æ –µ—Å—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–æ–ª–≥–∏:
- –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ bot.ts
- –¢–∏–ø–∏–∑–∞—Ü–∏—è (as any)
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- Hardcoded –∑–Ω–∞—á–µ–Ω–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ –ù–µ–¥–µ–ª—é 2.

---

**–ê–≤—Ç–æ—Ä —Ä–µ–≤—å—é**: Senior Architect  
**–î–∞—Ç–∞**: 2025-11-03  
**–í–µ—Ä—Å–∏—è**: 1.0
