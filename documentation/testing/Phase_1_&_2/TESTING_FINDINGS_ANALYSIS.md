# üìã –ê–Ω–∞–ª–∏–∑ –∑–∞–º–µ—á–∞–Ω–∏–π —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Iteration 1

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞**: 2025-11-04  
**–°—Ç–∞—Ç—É—Å**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

## üìä –ú–∞—Ç—Ä–∏—Ü–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∑–∞–º–µ—á–∞–Ω–∏–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

| ‚Ññ | –¢–µ—Å—Ç-–∫–µ–π—Å | –ó–∞–º–µ—á–∞–Ω–∏–µ | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---|-----------|----------|---------------------------|--------|-----------|
| 1 | TC-003 | –í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é (12) | ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç | **–î–ò–ó–ê–ô–ù** | üü° –°—Ä–µ–¥–Ω–∏–π |
| 2 | TC-003 | –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–∫–∞–∑–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å | ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç | **–î–ò–ó–ê–ô–ù** | üü° –°—Ä–µ–¥–Ω–∏–π |
| 3 | TC-004 | PlayerJoined –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è | ‚ùå **–ö–†–ò–¢–ò–ß–ù–û** | **–ë–ê–ì** | üî¥ –í—ã—Å–æ–∫–∏–π |
| 4 | TC-005 | PlayerJoined —Å status='waitlisted' –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è | ‚ùå **–ö–†–ò–¢–ò–ß–ù–û** | **–ë–ê–ì** | üî¥ –í—ã—Å–æ–∫–∏–π |
| 5 | TC-006 | RegistrationCanceled –Ω–µ –≤ –ª–æ–≥–∞—Ö | ‚ùå **–ö–†–ò–¢–ò–ß–ù–û** | **–ë–ê–ì** | üî¥ –í—ã—Å–æ–∫–∏–π |
| 6 | TC-007 | PaymentAttemptRejectedEarly –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è | ‚ùå **–ö–†–ò–¢–ò–ß–ù–û** | **–ë–ê–ì** | üî¥ –í—ã—Å–æ–∫–∏–π |
| 7 | TC-008 | PaymentMarked –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è | ‚ùå **–ö–†–ò–¢–ò–ß–ù–û** | **–ë–ê–ì** | üî¥ –í—ã—Å–æ–∫–∏–π |
| 8 | TC-009 | –£–ª—É—á—à–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ | ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç | **UX** | üü¢ –ù–∏–∑–∫–∏–π |
| 9 | TC-010 | –û—à–∏–±–∫–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è waitlist –≤–º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏ | ‚ùå **–ö–†–ò–¢–ò–ß–ù–û** | **–ë–ê–ì** | üî¥ –í—ã—Å–æ–∫–∏–π |
| 10 | TC-011 | –í—ã–≤–æ–¥—è—Ç—Å—è –∑–∞–∫—Ä—ã—Ç—ã–µ –∏–≥—Ä—ã | ‚ùå **–ö–†–ò–¢–ò–ß–ù–û** | **–ë–ê–ì** | üî¥ –í—ã—Å–æ–∫–∏–π |
| 11 | TC-012 | /my –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞" | ‚ùå **–ö–†–ò–¢–ò–ß–ù–û** | **–ë–ê–ì** | üî¥ –í—ã—Å–æ–∫–∏–π |
| 12 | TC-013 | –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ (–æ–∂–∏–¥–∞–µ–º–æ) | ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç | **OK** | üü¢ N/A |
| 13 | TC-015 | –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ID (–æ–∂–∏–¥–∞–µ–º–æ) | ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç | **OK** | üü¢ N/A |
| 14 | TC-021 | –û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã –¥–ª—è –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ | ‚ùå **–†–ê–°–•–û–ñ–î–ï–ù–ò–ï** | **–ë–ê–ì** | üî¥ –í—ã—Å–æ–∫–∏–π |
| 15 | TC-025 | /payments –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞" | ‚ùå **–ö–†–ò–¢–ò–ß–ù–û** | **–ë–ê–ì** | üî¥ –í—ã—Å–æ–∫–∏–π |
| 16 | TC-027 | –ó–∞–∫—Ä—ã—Ç–∏–µ –∏–≥—Ä—ã: –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ ‚Üí waitlist | ‚ùå **–†–ê–°–•–û–ñ–î–ï–ù–ò–ï** | **–ë–ê–ì** | üî¥ –í—ã—Å–æ–∫–∏–π |

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π

### 1Ô∏è‚É£ **–ì—Ä—É–ø–ø–∞: –°–æ–±—ã—Ç–∏—è –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è** (TC-004, TC-005, TC-006, TC-007, TC-008)

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:
- **–ò—Å—Ç–æ—á–Ω–∏–∫**: [`documentation/planning/domain_model_design.md:155`](documentation/planning/domain_model_design.md:155)
- **–û–∂–∏–¥–∞–Ω–∏–µ**: –°–æ–±—ã—Ç–∏—è –¥–æ–ª–∂–Ω—ã –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å—Å—è –≤ Event Bus –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- **–ü—Ä–∏–º–µ—Ä—ã**:
  - `PlayerJoined` ‚Üí [`src/infrastructure/event-setup.ts:194`](src/infrastructure/event-setup.ts:194) (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –µ—Å—Ç—å)
  - `RegistrationCanceled` ‚Üí [`src/application/use-cases.ts:76`](src/application/use-cases.ts:76) (–ø—É–±–ª–∏–∫–∞—Ü–∏—è –µ—Å—Ç—å)
  - `PaymentMarked` ‚Üí [`src/application/use-cases.ts:200`](src/application/use-cases.ts:200) (–ø—É–±–ª–∏–∫–∞—Ü–∏—è –µ—Å—Ç—å)

#### –†–µ–∞–ª—å–Ω–æ—Å—Ç—å:
- ‚ùå –°–æ–±—ã—Ç–∏—è –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –≤ –∫–æ–¥–µ, –Ω–æ **–Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –ª–æ–≥–∏**
- ‚ùå Event Bus –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- ‚ùå –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è

#### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:
–í–µ—Ä–æ—è—Ç–Ω–æ, `setupEventHandlers()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**: [`src/bot.ts`](src/bot.ts) –∏ [`src/index.ts`](src/index.ts)

---

### 2Ô∏è‚É£ **–ì—Ä—É–ø–ø–∞: –ö–æ–º–∞–Ω–¥—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç** (TC-012, TC-025)

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:
- **–ò—Å—Ç–æ—á–Ω–∏–∫**: [`documentation/planning/event_storming.md:36`](documentation/planning/event_storming.md:36)
- **–û–∂–∏–¥–∞–Ω–∏–µ**: –ö–æ–º–∞–Ω–¥—ã `/my` –∏ `/payments <id>` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –±–æ—Ç–µ

#### –†–µ–∞–ª—å–Ω–æ—Å—Ç—å:
- ‚ùå –ö–æ–º–∞–Ω–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞"
- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç: [`src/bot/command-handlers.ts:125`](src/bot/command-handlers.ts:125) –∏ [`src/bot/command-handlers.ts:160`](src/bot/command-handlers.ts:160)

#### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:
–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –±–æ—Ç–µ. –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å [`src/bot.ts`](src/bot.ts).

---

### 3Ô∏è‚É£ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –∏–≥—Ä** (TC-011)

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:
- **–ò—Å—Ç–æ—á–Ω–∏–∫**: [`documentation/planning/event_storming.md:83`](documentation/planning/event_storming.md:83)
- **–û–∂–∏–¥–∞–Ω–∏–µ**: Read Model `UpcomingGamesList` –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ—Ç–∫—Ä—ã—Ç—ã–µ –∏–≥—Ä—ã

#### –†–µ–∞–ª—å–Ω–æ—Å—Ç—å:
- ‚ùå [`src/application/use-cases.ts:255`](src/application/use-cases.ts:255) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–≤—Å–µ** –∏–≥—Ä—ã –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞

```typescript
// –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
export async function listGames() {
  const games = await prisma.game.findMany({
    orderBy: { startsAt: 'asc' }
  });
  // ‚ùå –ù–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ status
}
```

---

### 4Ô∏è‚É£ **–õ–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –∏–≥—Ä—ã** (TC-027)

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:
- **–ò—Å—Ç–æ—á–Ω–∏–∫**: [`documentation/planning/domain_model_design.md:50-54`](documentation/planning/domain_model_design.md:50-54)
- **–û–∂–∏–¥–∞–Ω–∏–µ**: 
  - `status = 'closed'` ‚Üí –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **–æ—Ç–∫–ª–æ–Ω–µ–Ω—ã** —Å –æ—à–∏–±–∫–æ–π
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: [`src/domain/game.ts:35`](src/domain/game.ts:35)

```typescript
ensureCanJoin(confirmedCount: number) {
  if (this.status !== GameStatus.open) 
    throw new DomainError(ERROR_CODES.GAME_NOT_OPEN, '–ò–≥—Ä–∞ –Ω–µ –æ—Ç–∫—Ä—ã—Ç–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏');
}
```

#### –†–µ–∞–ª—å–Ω–æ—Å—Ç—å:
- ‚ùå –ù–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ `waitlist` –≤–º–µ—Å—Ç–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
- ‚ùå –õ–æ–≥–∏–∫–∞ –≤ [`src/application/services/game-service.ts`](src/application/services/game-service.ts) –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ–º–µ–Ω–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ

---

### 5Ô∏è‚É£ **–û–∫–Ω–æ –æ–ø–ª–∞—Ç—ã –¥–ª—è –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ** (TC-021)

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:
- **–ò—Å—Ç–æ—á–Ω–∏–∫**: [`documentation/planning/domain_model_design.md:188-203`](documentation/planning/domain_model_design.md:188-203)
- **–û–∂–∏–¥–∞–Ω–∏–µ**: 
  - –û—à–∏–±–∫–∞: "–¢–æ–ª—å–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –º–æ–≥—É—Ç –æ—Ç–º–µ—á–∞—Ç—å –æ–ø–ª–∞—Ç—É"
  - –°–æ–±—ã—Ç–∏–µ: `PaymentAttemptRejectedEarly`

#### –†–µ–∞–ª—å–Ω–æ—Å—Ç—å:
- ‚ùå –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è: "–æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã –µ—â–µ –Ω–µ –æ—Ç–∫—Ä—ã—Ç–æ"
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π error message (–ø—É—Ç–∞–µ—Ç –¥–≤–µ —Ä–∞–∑–Ω—ã–µ –æ—à–∏–±–∫–∏)

---

## üìù –°–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–æ–∫ (Fixes Required)

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï (–ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ MVP)

#### Fix #1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Event Bus –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
**–§–∞–π–ª**: [`src/bot.ts`](src/bot.ts) –∏–ª–∏ [`src/index.ts`](src/index.ts)

**–ü—Ä–æ–±–ª–µ–º–∞**: `setupEventHandlers()` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ**:
```typescript
import { setupEventHandlers } from './infrastructure/event-setup.js';
import { EventBus } from './shared/event-bus.js';

const eventBus = new EventBus();
await setupEventHandlers(eventBus);
```

---

#### Fix #2: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ /my –∏ /payments
**–§–∞–π–ª**: [`src/bot.ts`](src/bot.ts)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–º–∞–Ω–¥—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –±–æ—Ç–µ

**–†–µ—à–µ–Ω–∏–µ**:
```typescript
bot.command('my', (ctx) => CommandHandlers.handleMy(ctx));
bot.command('payments', (ctx) => {
  const gameId = ctx.message?.text?.split(' ')[1];
  if (!gameId) {
    ctx.reply('–ò—Å–ø–æ–ª—å–∑—É–π: /payments <gameId>');
    return;
  }
  CommandHandlers.handlePayments(ctx, gameId);
});
```

---

#### Fix #3: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –∏–≥—Ä
**–§–∞–π–ª**: [`src/application/use-cases.ts:255`](src/application/use-cases.ts:255)

**–ü—Ä–æ–±–ª–µ–º–∞**: `listGames()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∏–≥—Ä—ã

**–†–µ—à–µ–Ω–∏–µ**:
```typescript
export async function listGames() {
  const games = await prisma.game.findMany({
    where: { status: 'open' },  // ‚Üê –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
    orderBy: { startsAt: 'asc' }
  });
  // ...
}
```

---

#### Fix #4: –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –Ω–∞ –∑–∞–∫—Ä—ã—Ç—É—é –∏–≥—Ä—É
**–§–∞–π–ª**: [`src/application/services/game-service.ts`](src/application/services/game-service.ts)

**–ü—Ä–æ–±–ª–µ–º–∞**: –õ–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ waitlist –≤–º–µ—Å—Ç–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `ensureCanJoin()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–¥–æ** –ø—Ä–æ–≤–µ—Ä–∫–∏ capacity:
```typescript
// –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫:
1. game.ensureCanJoin(confirmedCount)  // ‚Üê –ü—Ä–æ–≤–µ—Ä—è–µ—Ç status === 'open'
2. if (confirmedCount < capacity) ‚Üí confirmed
3. else ‚Üí waitlisted
```

---

#### Fix #5: –†–∞–∑–ª–∏—á–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –æ–ø–ª–∞—Ç—ã
**–§–∞–π–ª**: [`src/application/use-cases.ts:97-111`](src/application/use-cases.ts:97-111)

**–ü—Ä–æ–±–ª–µ–º–∞**: –î–≤–µ —Ä–∞–∑–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ**:
```typescript
export async function markPayment(gameId: string, userId: string) {
  // ...
  const game = await gameRepo.findById(gameId);
  
  // –û—à–∏–±–∫–∞ 1: –û–∫–Ω–æ –æ–ø–ª–∞—Ç—ã –µ—â–µ –Ω–µ –æ—Ç–∫—Ä—ã—Ç–æ
  if (new Date() < game.startsAt) {
    await eventPublisher.publish(evt('PaymentAttemptRejectedEarly', { gameId, userId }));
    throw new DomainError('PAYMENT_WINDOW_NOT_OPEN', '–û–∫–Ω–æ –æ–ø–ª–∞—Ç—ã –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã');
  }
  
  // –û—à–∏–±–∫–∞ 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
  const reg = await registrationRepo.get(gameId, userId);
  if (!reg || reg.status !== RegStatus.confirmed) {
    throw new DomainError('NOT_CONFIRMED', '–¢–æ–ª—å–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –º–æ–≥—É—Ç –æ—Ç–º–µ—á–∞—Ç—å –æ–ø–ª–∞—Ç—É');
  }
  // ...
}
```

---

### üü° –°–†–ï–î–ù–ò–ï (UX —É–ª—É—á—à–µ–Ω–∏—è)

#### Fix #6: –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
**–§–∞–π–ª**: [`src/bot/command-handlers.ts:32-54`](src/bot/command-handlers.ts:32-54)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–µ

**–†–µ—à–µ–Ω–∏–µ**:
```typescript
try {
  const result = await joinGame(gameId, user.id!);
  // ...
} catch (error: any) {
  if (error.code === 'ALREADY_REGISTERED') {
    await ctx.reply('–í—ã —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —ç—Ç—É –∏–≥—Ä—É');
  } else {
    await ctx.reply(ErrorHandler.mapToUserMessage(error));
  }
}
```

–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `joinGame()`:
```typescript
const existing = await registrationRepo.get(gameId, userId);
if (existing && existing.status === RegStatus.confirmed) {
  throw new DomainError('ALREADY_REGISTERED', '–í—ã —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —ç—Ç—É –∏–≥—Ä—É');
}
```

---

#### Fix #7: –í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é
**–§–∞–π–ª**: [`src/bot/game-creation-wizard.ts`](src/bot/game-creation-wizard.ts)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–∫–∞–∑–∞—Ç—å –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å default

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å —à–∞–≥ –≤ wizard —Å default –∑–Ω–∞—á–µ–Ω–∏–µ–º 12

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–∞–≤–æ–∫

### Sprint 1 (–ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ):
1. ‚úÖ Fix #1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Event Bus
2. ‚úÖ Fix #2: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ /my –∏ /payments
3. ‚úÖ Fix #3: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –∏–≥—Ä
4. ‚úÖ Fix #4: –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –Ω–∞ –∑–∞–∫—Ä—ã—Ç—É—é –∏–≥—Ä—É
5. ‚úÖ Fix #5: –†–∞–∑–ª–∏—á–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –æ–ø–ª–∞—Ç—ã

### Sprint 2 (–£–ª—É—á—à–µ–Ω–∏—è):
6. ‚è≥ Fix #6: –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
7. ‚è≥ Fix #7: –í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é

---

## üìö –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏

| –î–æ–∫—É–º–µ–Ω—Ç | –†–∞–∑–¥–µ–ª | –°—Å—ã–ª–∫–∞ |
|----------|--------|--------|
| Domain Model Design | Use Cases | [`documentation/planning/domain_model_design.md:131-221`](documentation/planning/domain_model_design.md:131-221) |
| Event Storming | Commands | [`documentation/planning/event_storming.md:29-45`](documentation/planning/event_storming.md:29-45) |
| Architecture Overview | Event Flow | [`documentation/planning/architecture_overview.md:90-117`](documentation/planning/architecture_overview.md:90-117) |
| Domain Model Design | –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã | [`documentation/planning/domain_model_design.md:29-88`](documentation/planning/domain_model_design.md:29-88) |

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é Event Bus –≤ —Ç–æ—á–∫–µ –≤—Ö–æ–¥–∞
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `setupEventHandlers()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã `/my` –∏ `/payments` –≤ –±–æ—Ç–µ
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä `status: 'open'` –≤ `listGames()`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ `joinGame()` (ensureCanJoin –ø–µ—Ä–µ–¥ capacity)
- [ ] –†–∞–∑–¥–µ–ª–∏—Ç—å error codes –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ—à–∏–±–æ–∫ –æ–ø–ª–∞—Ç—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ TC-–∫–µ–π—Å—ã –∏–∑ iteration_1.md
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è event flow
